\documentclass{jps-cp}
\usepackage{txfonts} %Please comment out this line unless the txfonts package is availabe in your LaTeX system.
\usepackage{url}
\usepackage{multirow}
\usepackage{array, booktabs}
\usepackage{wrapfig}

\makeatletter
\newcommand{\figcaption}[1]{\def\@captype{figure}\caption{#1}}
\newcommand{\tblcaption}[1]{\def\@captype{table}\caption{#1}}

\title{New analysis method of TPC data using neural network}

\author{
  Takanobu \textsc{Doi}$^{1}$, Takahiro \textsc{Kawabata}$^{2}$, Tatsuya \textsc{Furuno}$^{3}$,
  Yuki \textsc{Fujikawa}$^{1}$, Kento \textsc{Inaba}$^{1}$, Motoki \textsc{Murata}$^{3}$,
  Shintaro \textsc{Okamoto}$^{1}$ and Akane \textsc{Sakaue}$^{1}$}

\inst{
  $^{1}$Department of Physics, Kyoto University, Kyoto, Kyoto 606-8502, Japan \\
  $^{2}$Department of Physics, Osaka University, Toyonaka, Osaka 540-0043, Japan \\
  $^{3}$Research Center for Nuclear Physics, Osaka University, Ibaraki, Osaka 567-0047, Japan }

\email{doi.takanobu.68x@st.kyoto-u.ac.jp}

\recdate{2019/8/4} % Write received date here

\abst{
  TPC を用いた実験では荷電粒子の飛跡を測定することができる。
  TPC では3次元的な荷電粒子の飛跡を2次元平面に射影した画像として得られるので、
  データの解析には画像解析を行う必要がある。
  従来はHough 変換を用いてデータの解析を行って来たが、
  この方法を用いた解析には多くの労力を要する。
  近年、画像データの認識にはニューラルネットワークが注目されている。
  本研究では、新しくニューラルネットワークを用いた解析方法の開発を行った。
  新しく開発した手法を用いることで、従来の方法と比較して高速に解析できるようになった。
} % Write abstract here

\kword{neural networks, convolutional neural networks,
  TPC, active target, MAIKo TPC} % Write keywords here

\begin{document}
\maketitle

\section{Introduction}
\begin{wrapfigure}{r}{16zw}
  \vspace{0zw}
  \centering
  \includegraphics[clip, width=16zw]{eps/MAIKo.eps}
  \caption{MAIKo TPC の概観}
  \label{fig:MAIKo}
  \vspace{0zw}
\end{wrapfigure}
近年、荷電粒子の飛跡を測定する検出器としてTime Projection Chamber (TPC) が
広く用いられている。
我々は不安定核実験のためにMicro Pixel Chamber ($\mu$-PIC)~\cite{mupic}を用いた
Mu-Pic based Active target for Inverse Kinematics . (MAIKo) TPC~\cite{MAIKo}を開発した。
MAIKo の概観図を Fig. \ref{fig:MAIKo} に示す。
TPC は検出器にガスを充填しておき、荷電粒子がガス中を通過するときに発生する
電子をドリフト電場 (上向き矢印) により読み出し面方向 (下向き) にドリフトさせる
ことで飛跡を検出する。
The $\mu$-PIC has of anode strips and cathode strips
which are arranged orthogonally.
These strips are aligned at 400-um intervals.
anode strip は Fig. \ref{fig:MAIKo}のx軸の方向、
cathode strip は z軸の方向と平行である。
The signals induced by the drifted electron are read out through the anode and 
cathode strips which provide the 2-dimensional position (x-axis and z-axis) 
of the particle tracks.
The vertical position (y-axis) of the tracks are determined 
from the drift time of the electrons.
x, y, zの座標が決定できるので、飛跡を3次元的に再構成することが出来る。


この検出器では検出ガスを実験の標的として用いるのでアクティブ標的と呼ばれる。
アクティブ標的では散乱が検出器内部で起こるため、大立体角で低エネルギー粒子の測定を行うことが可能となる。
広く標的ガスとして用いられるのは $\rm{He}$ や $\rm{H}_{2}$であるが、
これらのガスは放電耐性が低いので、
通常は放電耐性の高い $\rm{CO}_{2}$ やイソブタンをクエンチングガスとして
混合させてTPC を運用する。
このとき、クエンチングガスからの散乱は背景事象となる。
近年、大阪大学核物理研究センター (RCNP) において、
MAIKo TPC を用いた${}^{10}\rm{C}$と${}^{4}\rm{He}$の非弾性散乱の測定が初めて行われた。
この実験では標的ガスである$\rm{He}$ (96\%)に、$\rm{CO}_{2}$ (4\%)をクエンチングガスとして
混合して測定を行った。

MAIKo TPC において荷電粒子の飛跡は、
anode strip に垂直な面に射影された画像 (anode image) と
cathode strip に垂直な面に射影された画像 (cathode image) の2つの画像として取得される。
$\mu$-PIC の anode and cathode strips は256 本あり、
信号波高の時間変化は100 MHz で1024 samples 測定されるので、
取得される画像の解像度は256 $\times$ 1024 pixels となる。
Figs. \ref{fig:true} and \ref{fig:false} はRCNPで行われた実験で取得された
データの一例である。
Fig. \ref{fig:true} は$\rm{He}$ガスと散乱した事象、
Fig. \ref{fig:false} はクエンチングガスと散乱した事象である。

散乱実験では、散乱粒子のエネルギーと放出角度を決定する必要がある。
散乱粒子のエネルギーは散乱粒子がガス中で停止するまでの飛跡の長さから、
放出角度は散乱前後の粒子の飛跡から決定することが出来る。
飛跡情報の抽出を行うためには
\begin{itemize}
\item 標的との散乱事象と背景事象との選別
\item 飛跡の長さや方向などの物理的情報の抽出
\end{itemize}
の大きくわけて2つの解析が必要になる。

\begin{figure}
  \centering
  \begin{minipage}{0.4\columnwidth}
    \centering
    \includegraphics[clip, width=0.9\columnwidth]{eps/true.eps}
    \caption{${}^{10}\rm{C}+{}^{4}\rm{He}$の散乱事象}
    \label{fig:true}
  \end{minipage}
  \begin{minipage}{0.4\columnwidth}
    \centering
    \includegraphics[clip, width=0.9\columnwidth]{eps/false.eps}
    \caption{${}^{10}\rm{C}$とクエンチガスとの散乱事象}
    \label{fig:false}
  \end{minipage}
\end{figure}

Figs. \ref{fig:true} and \ref{fig:false} のような画像データに対して、
事象の選別や飛跡情報の抽出には多くの労力が必要となる。
そこで、我々は近年画像認識において多くの成果を出している
ニューラルネットワークを用いることで、
より高速な解析を行うことが出来る解析方法の開発を行った。

\section{Conventional analysis method}
従来は、得られたデータから背景事象の除去を行うのに、
画像中の直線を抽出する手法の１つである
Hough 変換を用いたアルゴリズムによって行ってきた。
In the Hough transformation, a hit pixel of the image at $(x_{i}, y_{i})$ is transformed into
a curved line in the $(\theta, r)$ parameter space (Hough space)
according to Eq. (\ref{eq:real2hough}).
\begin{equation}
  \label{eq:real2hough}
  r = x_{i}\cos\theta+y_{i}\sin\theta. 
\end{equation}
A point at $(\theta_{i}, r_{i})$ in the Hough space specify a straight line
in the image as given by Eq. (\ref{eq:hough2real}).
\begin{equation}
  \label{eq:hough2real}
  y = -\frac{x}{\tan\theta_{j}}+\frac{r_{j}}{\sin\theta_{j}}. 
\end{equation}

When the pixels in the anode or cathode image lie on a straight line,
their transformed curves intersect at one point at $(\theta_{j}, r_{j})$ in the Hough space.
Thus, the intersection point in the Hough space gives the particle track according to Eq. (\ref{eq:hough2real}).

抽出した直線の長さや角度、本数、配置に対して多くの条件を課すことによって、
$\rm{He}$との散乱事象を選別することが出来る。
さらに、選別された事象における$\rm{He}$の飛跡の長さや角度から、
散乱角とエネルギーを決定することが出来る。
しかし、事象選別に必要な条件には複雑な分岐を必要とし、
多くのパラメータを導入しなければならない。
そのため、パラメータの最適化や画像識別に多くの時間を必要とする。

パラメータの最適化には100 CPU を使用して約１日かかり、
その後の識別には１ eventあたり１秒かかった。
この手法による識別能力の評価には、画像データを人間が目で見て
散乱事象もしくは背景事象と判断した3000イベントを評価用データとして用いて行った。
全事象のうち、散乱事象または背景事象の区別を正しく判断することが
出来た事象数の割合を正解率としたとき、この従来型の解析手法では89\%の正解率であった。

\section{New analysis method}

従来手法では識別に複雑な分岐条件や多くの計算機パワー
が必要になるという問題点があった。
そこで、我々は近年注目されているニューラルネットワークを用いることで、
これらの問題点を克服する新しい解析方法の開発を試みた。
ニューラルネットワークを用いることで、複雑な条件分岐を導入することなく、
直線の位置、角度などの従来の解析手法ではまとめて扱うことの難しい
多くの特徴量を同時に考慮した画像識別が可能になるかもしれない。
また、ニューラルネットワークは一度構築するとその後は短時間で画像識別を行うことができる。
このようなニューラルネットワークの特徴を活かすことで、
従来のアルゴリズムでは実現が難しかった高い精度と短い識別時間を実現することが期待される。

\vspace{-2zw}
\begin{figure}
  \centering
  \begin{minipage}{0.4\columnwidth}
    \centering
    \includegraphics[clip, width=0.9\columnwidth]{eps/event_selection.eps}
    \caption{データの選別を行うためのニューラルネットワーク}
    \label{fig:selection}
  \end{minipage}
  \hfill
  \begin{minipage}{0.4\columnwidth}
    \centering
    \includegraphics[clip, width=0.9\columnwidth]{eps/point_detection.eps}
    \caption{画像から情報を抽出するためのニューラルネットワーク}
    \label{fig:extraction}
  \end{minipage}
\end{figure}

MAIKo TPC から得られるデータが画像であるため、画像認識に有用とされる
Convolutional Neural Network (CNN)~\cite{lenet,alexnet} を用いた。
CNN とはネットワーク内に畳み込み層を有するネットワーク構造である。
解析には事象の選別と飛跡情報の抽出の２つの段階があるため、
２種類のニューラルネットワークを用いて解析を行った。
事象の選別を行うニューラルネットワークと
画像から飛跡情報を抽出するニューラルネットワークの構造を
それぞれFigs. \ref{fig:selection} and \ref{fig:extraction}に示す。

事象選別のためのニュラルネットワークは、MAIKo TPC から得られる２つの画像を入力し、
その事象が標的と散乱した事象である確率を出力する。
出力された確率が50\%以上である場合にその事象を標的と散乱した事象であるとした。
anode image と cathode image では異なる特徴を持つため、
２つの入力が別れた構造を持つネットワークを構築した。
人間が判断したデータを用いて、学習および評価を行った。
学習には2,700 events、評価には300 events を使用した。

飛跡情報を抽出するためのネットワークには、
事象選別のときと同様に MAIKo TPC から得られる２つの飛跡画像を入力し、
散乱が起こった座標と反跳した${}^{4}\rm{He}$が停止した座標を出力させる。
%学習を効率的に行うために、出力される座標は各軸が0--1の範囲になるように規格化した座標系で得られる。
%このネットワークは２１層からなり、２入力１出力の形をしている。
教師データには従来手法で決定した座標を用いた。
学習には3,012 events、評価には1,554 events を使用した。

学習環境はIntel Core i7、Nvidia GeForce GTX 1080Ti、Ubuntu 18.04 LTS、
TensorFlow~\cite{tensorflow}+Keras~\cite{keras} を用いた。

\section{Result}
\begin{wrapfigure}{r}{25zw}
  \vspace{-6zw}
  \centering
  \includegraphics[clip, width=25zw]{eps/compare_mono.eps}
  \caption{ニューラルネットワークによって決定した座標とHough変換によって決定した座標との比較}
  \label{fig:result_detection}
  \vspace{-2zw}
\end{wrapfigure}

事象選別のためのニューラルネットワークは、2,700 events に対して200 回学習を行った。
学習にはおよそ26分、その後の推測には300 events に対しておよそ1秒かかった。
従来手法の評価に用いたのと同じ実験データのうち、300 eventsを用いて評価を行った結果、
正解率は96\%であった。
従来の手法と比較して高精度に事象選別を行うことが可能となった。
また、パラメータチューニングおよび選別に要する時間も大きく短縮することができた。

座標の決定のためのニューラルネットワークは、3,012 events に対して500 回学習を行った。
学習にはおよそ270分、その後の推測には1,554 events に対しておよそ2秒かかった。
学習後にニューラルネットワークが予測した座標と従来手法によって決定した座標の比較をFig. \ref{fig:result_detection} に示す。
学習データの散乱が起こった点を円、反跳粒子が停止した点を三角で示す。
学習後に推論によって決定した散乱が起こった点を四角、反跳粒子が停止した点をひし形で示す。
従来手法とニューラルネットワークを用いた手法のそれぞれで決定した座標は、
ほぼ一致している。
1,554 events に対して学習に用いた点とニューラルネットワークを用いて決定した点のズレは、
平均二乗誤差で約4 mm となった。
従来の手法と比較してパラメータチューニングおよび情報の抽出にかかる時間を短縮することができた。


\section{Conclusion}
従来のHough 変換を用いた画像識別アルゴリズムに変わる、
ニューラルネットワークを用いた新手法の開発を行った。
新手法は従来のものよりも高速かつ高精度に事象の選別を行うことが可能となった。
また、飛跡情報の抽出については従来の精度を保ちつつ、高速に行うことが可能となった。
ニューラルネットワークを用いた解析手法はTPC の解析に有用であることがわかった。

\begin{thebibliography}{9}
\bibitem{mupic}
  A.~Ochi, T.~Nagayoshi, T.~Tanimori, T.~Nagae, and M.~Nakamura
  Nuclear Instruments and Methods in Physics Research A \textbf{471} 264 (2001)
\bibitem{MAIKo}
  T.~Furuno, T.~Kawabata, H.~Ong, S.~Adachi, Y.~Ayyad, T.~Baba, Y.~Fujikawa, T.~Hashimoto, K.~Inaba, Y.~Ishii,
  S.~Kabuki, H.~Kubo, Y.~Matsuda, Y.~Matsuoka, T.~Mizumoto, T.~Morimoto, M.~Murata, T.~Sawano, T.~Suzuki, A.~Takada,
  J.~Tanaka, I.~Tanihata, T.~Tanimori, D.~Tran, M-, Tsumura, and H.~Watanabe
  Nuclear Instruments and Methods in Physics Research A \textbf{908} 215 (2018).
\bibitem{tensorflow}
  A.~Davis, J.~Dean, M.~Devin, S.~Ghemawat, I.~Goodfellow, A.~Harp, G.~Irving,
  M.~Isard, Y.~Jia, R.~Jozefowicz, L.~Kaiser, M.~Kudlur, J.~Levenberg,
  D.~Man\'{e}, R.~Monga, S.~Moore, D.~Murray, C.~Olah, M.~Schuster, J.~Shlens,
  B.~Steiner, I.~Sutskever, K.~Talwar, P.~Tucker, V.~Vanhoucke, V.~Vasudevan,
  F.~Vi\'{e}gas, O.~Vinyals, P.~Warden, M.~Wattenberg, M.~Wicke, Y.~Yu, and
  X.~Zheng, (2015).
  \url{https://tensorflow.org}
\bibitem{keras}
  F.~Chollet, et al. (2015). \url{https://keras.io}
\bibitem{lenet}
  Y.~LeCun, L.~Bottou, Y.~Bengio, and P.~Haffner
  Proceedings of the IEEE \textbf{86}, 11, 2278 (1998).
\bibitem{alexnet}
  Alex~Krizhevsky, Ilya~Sutskever, and Geoffrey~E.~Hinton
  Proceedings of the 25th International Conference on Neural Information Processing Systems - Volume \textbf{1}. 1097 (2012).
%\bibitem{vgg}
%  K.~Simonyan, and A.~Zisserman
%  arXiv:1409.1556 [cs] (2014).
%
  
%\bibitem{cp} The abbreviation for JPS Conference Proceedings should be ``JPS Conf. Proc." in the reference list.
%\bibitem{jpsj} The abbreviation for the Journal of the Physical Society of Japan should be ``J. Phys. Soc. Jpn." in the reference list.
%\bibitem{ptep} The abbreviation for the Progress of Theoretical and Experimental Physics should be ``Prog. Theor. Exp. Phys." in the reference list.
%\bibitem{instructions} More abbreviations of journal titles are listed in ``Instructions for Preparation of Manuscript", which is available at our Web site (http://jpsj.jps.or.jp).
%\bibitem{format} F. Author, S. Author, and T. Author, Abbreviated journal title \textbf{volume in bold face}, initial page or article number (year of publication).
\end{thebibliography}

\end{document}

